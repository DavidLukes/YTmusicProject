<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Now Playing - YouTube Music</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      min-height: 100vh;
      overflow: hidden;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
    }

    /* Dynamic blurred background */
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background-size: cover;
      background-position: center;
      filter: blur(120px) brightness(0.6) saturate(1.4);
      transform: scale(1.2);
      z-index: -2;
      transition: background-image 1s ease;
    }

    /* Gradient overlay for depth */
    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 50% 50%, rgba(0, 0, 0, 0.2) 0%, rgba(0, 0, 0, 0.6) 100%);
      z-index: -1;
    }

    .glass-container {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(50px) saturate(200%);
      -webkit-backdrop-filter: blur(50px) saturate(200%);
      border-radius: 40px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow:
        0 20px 80px 0 rgba(0, 0, 0, 0.4),
        inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
      padding: 60px;
      max-width: 1400px;
      width: 95%;
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 80px;
      position: relative;
      overflow: hidden;
      animation: fadeIn 0.8s ease;
    }

    /* Subtle shimmer effect */
    .glass-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg,
          transparent,
          rgba(255, 255, 255, 0.05),
          transparent);
      transition: left 0.5s ease;
      pointer-events: none;
    }

    .album-art-container {
      flex: 0 0 500px;
      width: 500px;
      position: relative;
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .album-art-wrapper {
      position: relative;
      border-radius: 24px;
      overflow: hidden;
      box-shadow:
        0 30px 60px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(255, 255, 255, 0.1);
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      aspect-ratio: 1;
    }

    .album-art {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: all 0.6s ease;
    }

    .playing .album-art-wrapper {
      animation: pulse-glow 4s ease-in-out infinite;
    }

    @keyframes pulse-glow {

      0%,
      100% {
        box-shadow:
          0 30px 60px rgba(0, 0, 0, 0.5),
          0 0 0 1px rgba(255, 255, 255, 0.1);
      }

      50% {
        box-shadow:
          0 30px 60px rgba(0, 0, 0, 0.5),
          0 0 0 1px rgba(255, 255, 255, 0.3),
          0 0 80px 20px rgba(255, 255, 255, 0.15);
      }
    }

    .paused .album-art {
      filter: grayscale(0.3);
    }

    /* Info panel */
    .info-panel {
      flex: 1;
      text-align: left;
      min-width: 0;
      /* Prevent flex overflow */
    }

    .track-title {
      font-weight: 800;
      font-size: 4.5rem;
      line-height: 1.2;
      color: #ffffff;
      margin-bottom: 24px;
      transition: all 0.4s ease;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      padding: 0.1em 0;
    }

    .track-artist {
      font-weight: 600;
      font-size: 2.25rem;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 16px;
      transition: all 0.4s ease;
    }

    .track-year {
      font-weight: 500;
      font-size: 1.5rem;
      color: rgba(255, 255, 255, 0.7);
      transition: all 0.4s ease;
    }

    .fade-in {
      animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Loading state */
    .loading-state {
      animation: fade-pulse 2s ease-in-out infinite;
    }

    @keyframes fade-pulse {

      0%,
      100% {
        opacity: 0.4;
      }

      50% {
        opacity: 0.7;
      }
    }

    /* Progress Bar */
    .progress-container {
      display: flex;
      align-items: center;
      gap: 16px;
      width: 100%;
      margin-top: 32px;
    }

    .time-label {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.6);
      min-width: 45px;
    }

    .progress-bar-bg {
      flex: 1;
      height: 4px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 2px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background: rgb(255, 255, 255);
      width: 0%;
      border-radius: 2px;
      transition: width 0.2s linear;
      box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
    }

    /* Screensaver */
    .screensaver {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000000;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1s ease;
    }

    .screensaver.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .screensaver-clock {
      font-family: 'Inter', monospace;
      font-size: 12rem;
      font-weight: 200;
      color: rgba(255, 255, 255, 0.1);
      line-height: 1;
      margin-bottom: 20px;
      text-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
    }

    .screensaver-date {
      font-family: 'Inter', sans-serif;
      font-size: 3rem;
      font-weight: 400;
      color: rgba(255, 255, 255, 0.1);
      text-transform: uppercase;
      letter-spacing: 4px;
    }

    /* Responsive adjustments */
    @media (max-width: 1200px) {
      .glass-container {
        padding: 40px;
        gap: 50px;
      }

      .album-art-container {
        flex: 0 0 400px;
        width: 400px;
      }

      .track-title {
        font-size: 3.5rem;
      }

      .screensaver-clock {
        font-size: 8rem;
      }

      .screensaver-date {
        font-size: 2rem;
      }
    }

    @media (max-width: 900px) {
      .glass-container {
        flex-direction: column;
        text-align: center;
        max-width: 500px;
        gap: 40px;
      }

      .album-art-container {
        flex: 0 0 auto;
        width: 100%;
        max-width: 350px;
      }

      .info-panel {
        text-align: center;
      }

      .track-title {
        font-size: 2.5rem;
      }

      .track-artist {
        font-size: 1.5rem;
      }

      .progress-container {
        margin-top: 24px;
      }

      .screensaver-clock {
        font-size: 6rem;
      }

      .screensaver-date {
        font-size: 1.5rem;
      }
    }

    /* Optimization for 800x490 (7-inch displays) */
    @media (max-width: 850px) and (max-height: 550px) {
      body {
        padding: 15px;
      }

      .glass-container {
        flex-direction: row;
        text-align: left;
        padding: 25px;
        gap: 30px;
        max-width: 100%;
        width: 98%;
        height: auto;
      }

      .album-art-container {
        flex: 0 0 200px;
        width: 200px;
        max-width: 200px;
      }

      .info-panel {
        text-align: left;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .track-title {
        font-size: 2.2rem;
        margin-bottom: 8px;
      }

      .track-artist {
        font-size: 1.4rem;
        margin-bottom: 6px;
      }

      .track-year {
        font-size: 1rem;
      }

      .progress-container {
        margin-top: 16px;
      }

      .screensaver-clock {
        font-size: 5rem;
      }

      .screensaver-date {
        font-size: 1.2rem;
      }
    }
  </style>
</head>

<body>
  <div class="glass-container">
    <div id="album-art-container" class="album-art-container">
      <div id="album-art-wrapper" class="album-art-wrapper">
        <img id="album-art" class="album-art" src="" alt="Album Art" />
      </div>
    </div>

    <div class="info-panel">
      <h1 id="track-title" class="track-title">
        Connecting...
      </h1>

      <p id="track-artist" class="track-artist">
        Please wait
      </p>

      <p id="track-year" class="track-year"></p>

      <div class="progress-container">
        <div id="current-time" class="time-label">0:00</div>
        <div class="progress-bar-bg">
          <div id="progress-fill" class="progress-bar-fill"></div>
        </div>
        <div id="total-time" class="time-label">0:00</div>
      </div>
    </div>
  </div>

  <div id="screensaver" class="screensaver">
    <div id="screensaver-clock" class="screensaver-clock">12:00</div>
    <div id="screensaver-date" class="screensaver-date">Monday, January 1</div>
  </div>

  <script>
    // Configuration
    const SERVER_URL = 'https://192.168.1.181:3000/now-playing';
    const POLL_INTERVAL = 1000; // Poll every 1 second for smooth progress
    const SCREENSAVER_DELAY = 300000; // Screensaver delay in milliseconds (10 seconds) 300000

    // DOM Elements
    const albumArtContainer = document.getElementById('album-art-container');
    const albumArtWrapper = document.getElementById('album-art-wrapper');
    const albumArt = document.getElementById('album-art');
    const trackTitle = document.getElementById('track-title');
    const trackArtist = document.getElementById('track-artist');
    const trackYear = document.getElementById('track-year');
    const currentTimeEl = document.getElementById('current-time');
    const totalTimeEl = document.getElementById('total-time');
    const progressFill = document.getElementById('progress-fill');
    const screensaverEl = document.getElementById('screensaver');
    const screensaverClockEl = document.getElementById('screensaver-clock');
    const screensaverDateEl = document.getElementById('screensaver-date');

    // State
    let currentTrackData = null;
    let isFirstLoad = true;
    let screensaverTimer = null;
    let screensaverInterval = null;

    /**
   * Updates the blurred background
   */
    function updateBackground(imageUrl) {
      if (imageUrl) {
        // Use ::before pseudo-element for the blur effect
        const style = document.createElement('style');

        style.textContent = ` body::before {
            background-image: url(${imageUrl});
          }

          `;
        // Remove old style if exists
        const oldStyle = document.querySelector('style[data-bg]');
        if (oldStyle) oldStyle.remove();
        style.setAttribute('data-bg', 'true');
        document.head.appendChild(style);
      }
    }

    /**
   * Fetches the current track data from the server
   */
    async function fetchNowPlaying() {
      try {
        const response = await fetch(SERVER_URL);

        if (!response.ok) {
          throw new Error(`Server error: $ {
                response.status
              }

              `);
        }

        const data = await response.json();
        updateDisplay(data);

      }

      catch (error) {
        console.error('Failed to fetch now playing data:', error);
        showErrorState();
      }
    }

    /**
   * Updates the display with new track data
   */
    function updateDisplay(data) {
      const {
        title,
        artist,
        albumArt: albumArtUrl, year, currentTime, totalTime, progress, isPlaying
      }

        = data;

      // Check if this is actually new data (excluding time/progress for main UI updates)
      const hasTrackChanged = !currentTrackData || currentTrackData.title !== title || currentTrackData.artist !== artist || currentTrackData.year !== year;

      currentTrackData = data;

      // Reset screensaver timer if track has changed
      if (hasTrackChanged) {
        stopScreensaverTimer();
      }

      // Update playing/paused state
      if (title === 'Nothing Playing' || !title) {
        showNothingPlayingState();
        startScreensaverTimer();
        return;
      }

      // Update album art and background
      if (albumArtUrl && albumArt.src !== albumArtUrl) {
        albumArt.src = albumArtUrl;

        albumArt.alt = `$ {
            title
          }

          by $ {
            artist
          }

          `;
        updateBackground(albumArtUrl);
      }

      else if (!albumArtUrl) {
        // Use a placeholder gradient if no album art
        const placeholderSvg = 'data:image/svg+xml,' + encodeURIComponent(` <svg width="600" height="600" xmlns="http://www.w3.org/2000/svg" > <defs> <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%" > <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" /> <stop offset="100%" style="stop-color:#6366f1;stop-opacity:1" /> </linearGradient> </defs> <rect width="600" height="600" fill="url(#grad)" /> <text x="50%" y="50%" font-family="Arial" font-size="80" fill="white" text-anchor="middle" dy=".3em" >ðŸŽµ</text> </svg> `);
        albumArt.src = placeholderSvg;
      }

      // Update text content
      trackTitle.textContent = title;
      trackArtist.textContent = artist || 'Unknown Artist';

      trackYear.textContent = year ? `Released: $ {
          year
        }

        ` : '';

      // Update progress
      currentTimeEl.textContent = currentTime || '0:00';
      totalTimeEl.textContent = totalTime || '0:00';

      progressFill.style.width = `$ {
          progress || 0
        }

        %`;

      // Update status styles
      if (isPlaying) {
        albumArtContainer.classList.remove('paused');
        albumArtContainer.classList.add('playing');
        stopScreensaverTimer();
      }

      else {
        albumArtContainer.classList.remove('playing');
        albumArtContainer.classList.add('paused');
        startScreensaverTimer();
      }

      // Add fade-in effect on first load or track change
      if (isFirstLoad || hasTrackChanged) {
        albumArtContainer.classList.remove('fade-in');
        void albumArtContainer.offsetWidth; // Trigger reflow
        albumArtContainer.classList.add('fade-in');
        isFirstLoad = false;
      }
    }

    /**
   * Shows the "Nothing Playing" state
   */
    function showNothingPlayingState() {
      trackTitle.textContent = 'Nothing Playing';
      trackArtist.textContent = 'Start playing music on YouTube Music';
      trackYear.textContent = '';
      currentTimeEl.textContent = '0:00';
      totalTimeEl.textContent = '0:00';
      progressFill.style.width = '0%';

      albumArtContainer.classList.remove('playing');
      albumArtContainer.classList.add('paused');

      // Show placeholder
      const placeholderSvg = 'data:image/svg+xml,' + encodeURIComponent(` <svg width="600" height="600" xmlns="http://www.w3.org/2000/svg" > <defs> <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%" > <stop offset="0%" style="stop-color:#4b5563;stop-opacity:1" /> <stop offset="100%" style="stop-color:#1f2937;stop-opacity:1" /> </linearGradient> </defs> <rect width="600" height="600" fill="url(#grad)" /> <text x="50%" y="50%" font-family="Arial" font-size="120" fill="#9ca3af" text-anchor="middle" dy=".3em" >â™ª</text> </svg> `);
      albumArt.src = placeholderSvg;
    }

    /**
   * Shows error state when server is unreachable
   */
    function showErrorState() {
      trackTitle.textContent = 'Connection Error';
      trackArtist.textContent = 'Unable to reach the server';
      trackYear.textContent = '';
      currentTimeEl.textContent = '--:--';
      totalTimeEl.textContent = '--:--';
      progressFill.style.width = '0%';
      albumArtContainer.classList.remove('playing');
      albumArtContainer.classList.add('paused');
    }

    /**
   * Screensaver Logic
   */
    function startScreensaverTimer() {
      if (screensaverEl.classList.contains('visible')) return;

      if (!screensaverTimer) {
        screensaverTimer = setTimeout(showScreensaver, SCREENSAVER_DELAY);
      }
    }

    function stopScreensaverTimer() {
      if (screensaverTimer) {
        clearTimeout(screensaverTimer);
        screensaverTimer = null;
      }

      hideScreensaver();
    }

    function showScreensaver() {
      updateScreensaverTime();
      screensaverEl.classList.add('visible');
      screensaverInterval = setInterval(updateScreensaverTime, 1000);
    }

    function hideScreensaver() {
      screensaverEl.classList.remove('visible');

      if (screensaverInterval) {
        clearInterval(screensaverInterval);
        screensaverInterval = null;
      }
    }

    function updateScreensaverTime() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');

      const timeString = `$ {
          hours
        }

        :$ {
          minutes
        }

        `;

      const options = {
        weekday: 'long', month: 'long', day: 'numeric'
      }

        ;
      const dateString = now.toLocaleDateString('cs-CZ', options);

      screensaverClockEl.textContent = timeString;
      screensaverDateEl.textContent = dateString;
    }

    /**
   * Initialize the display
   */
    function initialize() {
      console.log('YouTube Music Now Playing Display initialized');

      // Fetch immediately
      fetchNowPlaying();

      // Then poll at regular intervals
      setInterval(fetchNowPlaying, POLL_INTERVAL);
    }

    // Start when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initialize);
    }

    else {
      initialize();
    }

  </script>
</body>

</html>